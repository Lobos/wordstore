{%- extends theme('base.html') -%}
{%- import theme('_context.html') as h -%}
{% set active_nav = 'mine' %}
{% block body %}
    {% call h.title('我的词库') %}{% endcall %}
    <div class="content" id="word_list">
        {% for m in models %}
        <dl class="word" id="{{ m._id }}">
            <dt style="cursor:pointer;">
                <span class="span5">{{ m.word }}</span>
                <span class="span2 span">{{ m.add_time|format_datetime }}</span>
                <a class="remove span" href="javascript:;">× 删除</a>
            </dt>
        </dl>
        {% endfor %}
    </div>
    <script type="text/javascript">
        (function () {
            $$('#word_list > .word').addEvents({
                'mouseover': function () {
                    this.addClass('active');
                },
                'mouseout': function () {
                    this.removeClass('active');
                }
            });

            $$('#word_list dt').addEvent('click', function (event) {
                if (event.target.get('tag') == 'a')
                    return;

                var dd = this.getParent().getElement('dd');
                if (dd) {
                    dd.slide('toggle');
                } else {
                    dd = new Element('dd', {'class': 'active'}).inject(this, 'after');
                    var id = this.getParent().get('id');
                    new Request.HTML({
                        url: '{{ url_for(".single") }}' + id,
                        update: dd
                    }).get();
                }
            });

            $$('#word_list a.remove').addEvent('click', function () {
                var dl = this.getParent('dl');
                dl.loading();
                var id = dl.get('id');
                new Request.JSON({
                    url: '{{ url_for(".remove") }}',
                    data: { id: id },
                    onSuccess: function (json) {
                        dl.unloading();
                        if (json.status == 1)
                            dl.nix(true);
                    }
                }).send();
            });
        })();
    </script>
{% endblock %}